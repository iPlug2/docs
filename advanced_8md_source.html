<!-- HTML header for doxygen 1.8.14-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>iPlug2: advanced.md Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 80px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">iPlug2 - C++ Audio Plug-in Framework
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Home</span></a></li>
      <li><a href="modules.html"><span>Groups</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">advanced.md</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="preprocessor"># Advanced Documentation</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;Here are some docs <span class="keywordflow">for</span> experienced developers who want to <span class="keywordflow">try</span> and understand the inner workings of IPlug better, fix bugs and contribute pull requests.</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;## What is WDL?</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;IPlug depends on [WDL](https:<span class="comment">//www.cockos.com/wdl/) (whittle), which is Cockos&#39; open source library of lightweight reusable code for making cross-platform software. WDL makes very little use of the STL or of modern C++ features. The underlying code is a challenge to understand. It is arcane in places, and poorly documented but it generally works very well. It is developed by some great people who make legendary software and it powers what is undoubtably the best DAW - Reaper (at least from a programmer&#39;s perspective)! There is a reason Reaper is blazingly fast and lightweight.</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;The key parts of WDL that IPlug uses are: </div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;- [WDL_String](https:<span class="comment">//github.com/justinfrankel/WDL/blob/master/WDL/wdlstring.h): a simple class for variable-length string manipulation</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;- [WDL_PtrList](https:<span class="comment">//github.com/justinfrankel/WDL/blob/master/WDL/ptrlist.h): a simple templated class for a list of pointers</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;- [WDL_Heapbuf](https:<span class="comment">//github.com/justinfrankel/WDL/blob/master/WDL/heapbuf.h): a class and templated class (WDL_Typedbuf) for managing a block of memory</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;- [WDL_Mutex](https:<span class="comment">//github.com/justinfrankel/WDL/blob/master/WDL/mutex.h): a simple class that abstracts a mutex or critical section object</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;- [SWELL](https:<span class="comment">//github.com/justinfrankel/WDL/tree/master/WDL/swell): a wrapper that translates win32 API code to work on macOS Cocoa (and Linux GTK). In IPlug it is only used in order to build stand-alone versions of plug-ins, although it is also possible to use win32 controls as your UI and swell to make them work on macOS using native Cocoa controls. Pro tip: don&#39;t look at the swell code you will have nightmares.</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;</div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;IPlug makes extensive use of preprocessor macros in order to <span class="keywordflow">switch</span> functionality, without bloating binaries. This can <span class="keyword">get</span> ugly at times, but is unavoidable in a cross platform multi-format/api bridge such as this.</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor">## IPlug</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="preprocessor">### IPlugBase</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="preprocessor"></span>IPlugBase is the base <span class="keyword">class </span>for an IPlug plug-in, that will be inherited by classes that deal with the various plug-in format API stuff (e.g. IPlugVST), and eventually inherited by your plug-in implementation. It knows nothing about drawing or platform specific stuff such as locations of common folders. It facilitates plug-in set up, creation of parameters, managing of state and factory presets. </div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;### TODO: <a class="code" href="class_i_plug_processor.html">IPlugProcessor</a></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<a class="code" href="class_i_plug_processor.html">IPlugProcessor</a> is a lightweight base class to handle purely the audio processing side of the plug-in. This is primarily for WAMs, for which we require as little C++ as necessary to be compiled into web assembly, in order to minimise binary sizes. Normally for desktop plug-ins you will not deal with this class. </div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="preprocessor">## IGraphics (optional)</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<a class="code" href="class_i_graphics.html">IGraphics</a> is the pure <span class="keyword">virtual</span> *interface* primarily for drawing but also for doing platform specific stuff such as locating certain folders or creating native controls such as pop-up menus. There are several different classes that inherit the <a class="code" href="class_i_graphics.html">IGraphics</a> interface depending on which drawing API we want to use and which platform we are running on. To make this more complicated - on macOS, there are two different types of platform API: Cocoa (which uses Objective-C) and Carbon. Carbon is a deprecated API which does not support 64 -bit but you may decide it is necessary to support this for compatibility with some older 32 bit hosts. IPlug is designed to abstract these things away from plug-in implementation but it&#39;s good to know about them.</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;Different drawing APIs have different benefits:</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;* <a class="code" href="class_i_graphics_lice.html">IGraphicsLice</a>: This is the only drawing API that was in IPlug1. It uses Cockos&#39; LICE (Lightweight Image Compositing Engine), which is fast, lightweight and functional, but does not offer much in the way of vector graphics. Text is drawn using the operating system font routines, which means that fonts look different on different platforms. This requires usage of SWELL to access OS font functionality.</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;* <a class="code" href="class_i_graphics_cairo.html">IGraphicsCairo</a>: This uses the popular fast and powerful Cairo vector graphics library, but is quite heavyweight and will make your binaries bigger than if you use LICE. It can also be difficult to build the Cairo static libraries. Text is drawn with freetype.</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;* <a class="code" href="class_i_graphics_a_g_g.html">IGraphicsAGG</a>: This uses Anti-Grain Geometry 2.4. This is an experimental <a class="code" href="class_i_graphics.html">IGraphics</a> API class that can produce very nice results but appears to be quite a lot slower than other options. The drawing code is extremely verbose and complicated. Text is drawn with freetype which is quite a big dependency.</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;* <a class="code" href="class_i_graphics_nano_v_g.html">IGraphicsNanoVG</a>: TODO</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="preprocessor">### Selecting API</span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="preprocessor"></span>In order to provide support for multiple plug-in, drawing and platform APIs IPlug uses preprocessor macros extensively to switch different base classes depending on the target platform, drawing library. On macOS, IGraphicsMac is the top level class which inherits from IGRAPHICS_DRAW_CLASS. The value of this is changed depending on what preprocessor macros are set. Usually the preprocessor macros would be set in the MyPlugin.xcconfig file (on Mac) and MyPlugin.props (on Windows). These are simple files that are read by the IDE projects, and allow you to set build settings for multiple targets once rather than repeating the process manually inside the IDE for each target. For example to use cairo you would define IGRAPHICS_CAIRO in EXTRA_ALL_DEFS, which would set that preprocessor macro for all targets.</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="preprocessor">### Drawing</span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="preprocessor"></span>You create and attach a graphics object in your plug-ins constructor, using MakeGraphics() and IPlugBaseGraphics::AttachGraphics(). Depending on the frame rate that you specify when calling MakeGraphics, a platform timer will be created that triggers a callback at regular intervals (by default 30 times per second or every ~33 milliseconds). On macOS this callback is IGraphicsView::onTimer. This method will call mGraphics::IsDirty(), to ascertain which rectangular region of the plug-in&#39;s user interface needs to be drawn on this frame. <a class="code" href="class_i_graphics.html#a8ae509b2ee38016dd590f4e5dd06ac12">IGraphics::IsDirty</a>() loops through the plug-in controls checking if any of them are set &quot;dirty&quot;, and if they are adding the rectangular region they occupy to the region that is reported back. The OS will then call a method such as IGraphicsView::drawRect(), notifying that that part of the screen is to be drawn. This might be different to what we have explicitly specified needs drawing in <a class="code" href="class_i_graphics.html#a8ae509b2ee38016dd590f4e5dd06ac12">IGraphics::IsDirty</a>(). This will result in <a class="code" href="class_i_graphics.html#a5ba09c0140d7575b615be4bba75f0c88">IGraphics::Draw</a>() being called which will loop through the controls trying to find the ones which match this region that the OS is requesting be painted.</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;* Strict mode on (default): draw everything within the smallest rectangle that contains everything dirty.</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="comment">// Every control is guaranteed to get no more than one Draw() call per cycle.</span></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;* Strict mode off: draw only controls that intersect something dirty.</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="comment">// If there are overlapping controls, fast drawing can generate multiple Draw() calls per cycle</span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="comment">// (a control may be asked to draw multiple parts of itself, if it intersects with something dirty.)</span></div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;There is no Z order testing - so if you bring up an &quot;about box&quot; or panel on top of controls that are being set dirty, those controls will still redraw. This is obviously important if the control on top has an alpha channel (see-through parts), but wasteful if not. In practice this is not a problem for the majority of plug-in apis, but if it causes problems in your plug-in, the solution is to explicitly hide controls that are not on screen. </div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;--&gt;</div>
<div class="ttc" id="class_i_graphics_lice_html"><div class="ttname"><a href="class_i_graphics_lice.html">IGraphicsLice</a></div><div class="ttdoc">IGraphics draw class using Cockos&#39; LICE. </div><div class="ttdef"><b>Definition:</b> <a href="_i_graphics_lice_8h_source.html#l00076">IGraphicsLice.h:76</a></div></div>
<div class="ttc" id="class_i_graphics_cairo_html"><div class="ttname"><a href="class_i_graphics_cairo.html">IGraphicsCairo</a></div><div class="ttdoc">IGraphics draw class using Cairo. </div><div class="ttdef"><b>Definition:</b> <a href="_i_graphics_cairo_8h_source.html#l00057">IGraphicsCairo.h:57</a></div></div>
<div class="ttc" id="class_i_graphics_a_g_g_html"><div class="ttname"><a href="class_i_graphics_a_g_g.html">IGraphicsAGG</a></div><div class="ttdoc">IGraphics draw class using Antigrain Geometry. </div><div class="ttdef"><b>Definition:</b> <a href="_i_graphics_a_g_g_8h_source.html#l00064">IGraphicsAGG.h:64</a></div></div>
<div class="ttc" id="class_i_graphics_html_a5ba09c0140d7575b615be4bba75f0c88"><div class="ttname"><a href="class_i_graphics.html#a5ba09c0140d7575b615be4bba75f0c88">IGraphics::Draw</a></div><div class="ttdeci">void Draw(IRECTList &amp;rects)</div><div class="ttdoc">Called by the platform class when an area needs to be redrawn. </div><div class="ttdef"><b>Definition:</b> <a href="_i_graphics_8cpp_source.html#l00708">IGraphics.cpp:708</a></div></div>
<div class="ttc" id="class_i_graphics_html"><div class="ttname"><a href="class_i_graphics.html">IGraphics</a></div><div class="ttdoc">The lowest level base class of an IGraphics context. </div><div class="ttdef"><b>Definition:</b> <a href="_i_graphics_8h_source.html#l00064">IGraphics.h:64</a></div></div>
<div class="ttc" id="class_i_plug_processor_html"><div class="ttname"><a href="class_i_plug_processor.html">IPlugProcessor</a></div><div class="ttdoc">The base class for IPlug Audio Processing. </div><div class="ttdef"><b>Definition:</b> <a href="_i_plug_processor_8h_source.html#l00036">IPlugProcessor.h:36</a></div></div>
<div class="ttc" id="class_i_graphics_html_a8ae509b2ee38016dd590f4e5dd06ac12"><div class="ttname"><a href="class_i_graphics.html#a8ae509b2ee38016dd590f4e5dd06ac12">IGraphics::IsDirty</a></div><div class="ttdeci">bool IsDirty(IRECTList &amp;rects)</div><div class="ttdoc">Called repeatedly at frame rate by the platform class to check what the graphics context says is dirt...</div><div class="ttdef"><b>Definition:</b> <a href="_i_graphics_8cpp_source.html#l00615">IGraphics.cpp:615</a></div></div>
<div class="ttc" id="class_i_graphics_nano_v_g_html"><div class="ttname"><a href="class_i_graphics_nano_v_g.html">IGraphicsNanoVG</a></div><div class="ttdoc">IGraphics draw class using NanoVG. </div><div class="ttdef"><b>Definition:</b> <a href="_i_graphics_nano_v_g_8h_source.html#l00111">IGraphicsNanoVG.h:111</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon Jan 28 2019 21:26:11 for iPlug2 by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.6
</small></address>
</body>
</html>
