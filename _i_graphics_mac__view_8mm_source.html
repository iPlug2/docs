<!-- HTML header for doxygen 1.8.14-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>iPlug2: IGraphicsMac_view.mm Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 80px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">iPlug2 - C++ Audio Plug-in Framework
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Home</span></a></li>
      <li><a href="modules.html"><span>Groups</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_c70994b0d9919a11b368e677cb7f323c.html">IGraphics</a></li><li class="navelem"><a class="el" href="dir_e4d4be9d96bdd22d6611b01668e2ff02.html">Platforms</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">IGraphicsMac_view.mm</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> ==============================================================================</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> This file is part of the iPlug 2 library. Copyright (C) the iPlug 2 developers.</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> See LICENSE.txt for  more info.</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"> ==============================================================================</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">*/</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="preprocessor">#ifndef NO_IGRAPHICS</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="preprocessor">#ifdef IGRAPHICS_NANOVG</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#import &lt;QuartzCore/QuartzCore.h&gt;</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="preprocessor">#import &quot;IGraphicsMac_view.h&quot;</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="_i_control_8h.html">IControl.h</a>&quot;</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="_i_plug_parameter_8h.html">IPlugParameter.h</a>&quot;</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="_i_plug_logger_8h.html">IPlugLogger.h</a>&quot;</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> MacKeyCodeToVK(<span class="keywordtype">int</span> code)</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;{</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;  <span class="keywordflow">switch</span> (code)</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;  {</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;    <span class="keywordflow">case</span> 51: <span class="keywordflow">return</span> kVK_BACK;</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;    <span class="keywordflow">case</span> 65: <span class="keywordflow">return</span> kVK_DECIMAL;</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;    <span class="keywordflow">case</span> 67: <span class="keywordflow">return</span> kVK_MULTIPLY;</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;    <span class="keywordflow">case</span> 69: <span class="keywordflow">return</span> kVK_ADD;</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;    <span class="keywordflow">case</span> 71: <span class="keywordflow">return</span> kVK_NUMLOCK;</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;    <span class="keywordflow">case</span> 75: <span class="keywordflow">return</span> kVK_DIVIDE;</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;    <span class="keywordflow">case</span> 76: <span class="keywordflow">return</span> kVK_RETURN | 0x8000;</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    <span class="keywordflow">case</span> 78: <span class="keywordflow">return</span> kVK_SUBTRACT;</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;    <span class="keywordflow">case</span> 81: <span class="keywordflow">return</span> kVK_SEPARATOR;</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    <span class="keywordflow">case</span> 82: <span class="keywordflow">return</span> kVK_NUMPAD0;</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    <span class="keywordflow">case</span> 83: <span class="keywordflow">return</span> kVK_NUMPAD1;</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;    <span class="keywordflow">case</span> 84: <span class="keywordflow">return</span> kVK_NUMPAD2;</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    <span class="keywordflow">case</span> 85: <span class="keywordflow">return</span> kVK_NUMPAD3;</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    <span class="keywordflow">case</span> 86: <span class="keywordflow">return</span> kVK_NUMPAD4;</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    <span class="keywordflow">case</span> 87: <span class="keywordflow">return</span> kVK_NUMPAD5;</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    <span class="keywordflow">case</span> 88: <span class="keywordflow">return</span> kVK_NUMPAD6;</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    <span class="keywordflow">case</span> 89: <span class="keywordflow">return</span> kVK_NUMPAD7;</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    <span class="keywordflow">case</span> 91: <span class="keywordflow">return</span> kVK_NUMPAD8;</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    <span class="keywordflow">case</span> 92: <span class="keywordflow">return</span> kVK_NUMPAD9;</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    <span class="keywordflow">case</span> 96: <span class="keywordflow">return</span> kVK_F5;</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    <span class="keywordflow">case</span> 97: <span class="keywordflow">return</span> kVK_F6;</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    <span class="keywordflow">case</span> 98: <span class="keywordflow">return</span> kVK_F7;</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    <span class="keywordflow">case</span> 99: <span class="keywordflow">return</span> kVK_F3;</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    <span class="keywordflow">case</span> 100: <span class="keywordflow">return</span> kVK_F8;</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    <span class="keywordflow">case</span> 101: <span class="keywordflow">return</span> kVK_F9;</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    <span class="keywordflow">case</span> 109: <span class="keywordflow">return</span> kVK_F10;</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    <span class="keywordflow">case</span> 103: <span class="keywordflow">return</span> kVK_F11;</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    <span class="keywordflow">case</span> 111: <span class="keywordflow">return</span> kVK_F12;</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    <span class="keywordflow">case</span> 114: <span class="keywordflow">return</span> kVK_INSERT;</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    <span class="keywordflow">case</span> 115: <span class="keywordflow">return</span> kVK_HOME;</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    <span class="keywordflow">case</span> 117: <span class="keywordflow">return</span> kVK_DELETE;</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    <span class="keywordflow">case</span> 116: <span class="keywordflow">return</span> kVK_PRIOR;</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    <span class="keywordflow">case</span> 118: <span class="keywordflow">return</span> kVK_F4;</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    <span class="keywordflow">case</span> 119: <span class="keywordflow">return</span> kVK_END;</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    <span class="keywordflow">case</span> 120: <span class="keywordflow">return</span> kVK_F2;</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    <span class="keywordflow">case</span> 121: <span class="keywordflow">return</span> kVK_NEXT;</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    <span class="keywordflow">case</span> 122: <span class="keywordflow">return</span> kVK_F1;</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    <span class="keywordflow">case</span> 123: <span class="keywordflow">return</span> kVK_LEFT;</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    <span class="keywordflow">case</span> 124: <span class="keywordflow">return</span> kVK_RIGHT;</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    <span class="keywordflow">case</span> 125: <span class="keywordflow">return</span> kVK_DOWN;</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    <span class="keywordflow">case</span> 126: <span class="keywordflow">return</span> kVK_UP;</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    <span class="keywordflow">case</span> 0x69: <span class="keywordflow">return</span> kVK_F13;</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    <span class="keywordflow">case</span> 0x6B: <span class="keywordflow">return</span> kVK_F14;</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    <span class="keywordflow">case</span> 0x71: <span class="keywordflow">return</span> kVK_F15;</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    <span class="keywordflow">case</span> 0x6A: <span class="keywordflow">return</span> kVK_F16;</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;  }</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;  <span class="keywordflow">return</span> kVK_NONE;</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;}</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> MacKeyEventToVK(NSEvent* pEvent, <span class="keywordtype">int</span>&amp; flag)</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;{</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;  <span class="keywordtype">int</span> code = kVK_NONE;</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;  </div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;  <span class="keyword">const</span> NSInteger mod = [pEvent modifierFlags];</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;  </div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;  <span class="keywordflow">if</span> (mod &amp; NSShiftKeyMask) flag |= kFSHIFT;</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;  <span class="keywordflow">if</span> (mod &amp; NSCommandKeyMask) flag |= kFCONTROL; <span class="comment">// todo: this should be command once we figure it out</span></div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;  <span class="keywordflow">if</span> (mod &amp; NSAlternateKeyMask) flag |= kFALT;</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;  </div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;  <span class="keywordtype">int</span> rawcode = [pEvent keyCode];</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;  </div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;  code = MacKeyCodeToVK(rawcode);</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;  <span class="keywordflow">if</span> (code == kVK_NONE)</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;  {</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    NSString *str = NULL;</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    </div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    <span class="keywordflow">if</span> (!str || ![str length]) str = [pEvent charactersIgnoringModifiers];</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    </div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    <span class="keywordflow">if</span> (!str || ![str length])</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    {</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;      <span class="keywordflow">if</span> (!code)</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;      {</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;        code = 1024 + rawcode; <span class="comment">// raw code</span></div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;        flag |= kFVIRTKEY;</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;      }</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    }</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    {</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;      code = [str characterAtIndex:0];</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;      <span class="keywordflow">if</span> (code &gt;= NSF1FunctionKey &amp;&amp; code &lt;= NSF24FunctionKey)</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;      {</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;        flag |= kFVIRTKEY;</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;        code += kVK_F1 - NSF1FunctionKey;</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;      }</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;      {</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;        <span class="keywordflow">if</span> (code &gt;= <span class="charliteral">&#39;a&#39;</span> &amp;&amp; code &lt;= <span class="charliteral">&#39;z&#39;</span>) code += &#39;A&#39;-&#39;a&#39;;</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;        <span class="keywordflow">if</span> (code == 25 &amp;&amp; (flag &amp; FSHIFT)) code = kVK_TAB;</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;        <span class="keywordflow">if</span> (isalnum(code) || code==<span class="charliteral">&#39; &#39;</span> || code == <span class="charliteral">&#39;\r&#39;</span> || code == <span class="charliteral">&#39;\n&#39;</span> || code ==27 || code == kVK_TAB) flag |= kFVIRTKEY;</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;      }</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    }</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;  }</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;  {</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    flag |= kFVIRTKEY;</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    <span class="keywordflow">if</span> (code == 8) code = <span class="charliteral">&#39;\b&#39;</span>;</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;  }</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;  </div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;  <span class="keywordflow">if</span> (!(flag &amp; kFVIRTKEY)) flag &amp;= ~kFSHIFT;</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;  </div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;  <span class="keywordflow">return</span> code;</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;}</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;<span class="keyword">@implementation </span>IGRAPHICS_MENU_RCVR</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;- (NSMenuItem*)menuItem</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;{</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;  <span class="keywordflow">return</span> nsMenuItem;</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;}</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;- (void)onMenuSelection:(<span class="keywordtype">id</span>)sender</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;{</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;  nsMenuItem = sender;</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;}</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;<span class="keyword">@end</span></div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;<span class="keyword">@implementation </span>IGRAPHICS_MENU</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;- (id)initWithIPopupMenuAndReciever:(<a class="code" href="class_i_popup_menu.html">IPopupMenu</a>*)pMenu : (NSView*)pView</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;{</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;  [<span class="keyword">self</span> initWithTitle: @&quot;&quot;];</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;  NSMenuItem* nsMenuItem;</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;  NSMutableString* nsMenuItemTitle;</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;  [<span class="keyword">self</span> setAutoenablesItems:NO];</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;  <span class="keywordtype">int</span> numItems = pMenu-&gt;NItems();</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; numItems; ++i)</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;  {</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    <a class="code" href="class_i_popup_menu_1_1_item.html">IPopupMenu::Item</a>* pMenuItem = pMenu-&gt;GetItem(i);</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    nsMenuItemTitle = [[[NSMutableString alloc] initWithCString:pMenuItem-&gt;GetText() encoding:NSUTF8StringEncoding] autorelease];</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    <span class="keywordflow">if</span> (pMenu-&gt;GetPrefix())</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    {</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;      NSString* prefixString = 0;</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;      <span class="keywordflow">switch</span> (pMenu-&gt;GetPrefix())</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;      {</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;        <span class="keywordflow">case</span> 0: prefixString = [NSString stringWithUTF8String:&quot;&quot;]; <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;        <span class="keywordflow">case</span> 1: prefixString = [NSString stringWithFormat:@&quot;%1d: &quot;, i+1]; <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;        <span class="keywordflow">case</span> 2: prefixString = [NSString stringWithFormat:@&quot;%02d: &quot;, i+1]; <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;        <span class="keywordflow">case</span> 3: prefixString = [NSString stringWithFormat:@&quot;%03d: &quot;, i+1]; <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;      }</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;      [nsMenuItemTitle insertString:prefixString atIndex:0];</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    }</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    <span class="keywordflow">if</span> (pMenuItem-&gt;GetSubmenu())</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;    {</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;      nsMenuItem = [<span class="keyword">self</span> addItemWithTitle:nsMenuItemTitle action:nil keyEquivalent:@&quot;&quot;];</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;      NSMenu* subMenu = [[IGRAPHICS_MENU alloc] initWithIPopupMenuAndReciever:pMenuItem-&gt;GetSubmenu() :pView];</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;      [<span class="keyword">self</span> setSubmenu: subMenu forItem:nsMenuItem];</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;      [subMenu release];</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    }</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pMenuItem-&gt;GetIsSeparator())</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    {</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;      [<span class="keyword">self</span> addItem:[NSMenuItem separatorItem]];</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    }</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    {</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;      nsMenuItem = [<span class="keyword">self</span> addItemWithTitle:nsMenuItemTitle action:@selector(onMenuSelection:) keyEquivalent:@&quot;&quot;];</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;      </div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;      [nsMenuItem setTarget:pView];</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;      </div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;      <span class="keywordflow">if</span> (pMenuItem-&gt;GetIsTitle ())</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;      {</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;        [nsMenuItem setIndentationLevel:1];</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;      }</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;      <span class="keywordflow">if</span> (pMenuItem-&gt;GetChecked())</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;      {</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;        [nsMenuItem setState:NSOnState];</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;      }</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;      {</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;        [nsMenuItem setState:NSOffState];</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;      }</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;      <span class="keywordflow">if</span> (pMenuItem-&gt;GetEnabled())</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;      {</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;        [nsMenuItem setEnabled:YES];</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;      }</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;      {</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;        [nsMenuItem setEnabled:NO];</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;      }</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;    }</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;  }</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;  mIPopupMenu = pMenu;</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">self</span>;</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;}</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;- (<a class="code" href="class_i_popup_menu.html">IPopupMenu</a>*)iPopupMenu</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;{</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;  <span class="keywordflow">return</span> mIPopupMenu;</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;}</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;<span class="keyword">@end</span></div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;NSString* ToNSString(<span class="keyword">const</span> <span class="keywordtype">char</span>* cStr)</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;{</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;  <span class="keywordflow">return</span> [NSString stringWithCString:cStr encoding:NSUTF8StringEncoding];</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;}</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;<span class="keyword">inline</span> <span class="keywordtype">int</span> GetMouseOver(IGraphicsMac* pGraphics)</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;{</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;  <span class="keywordflow">return</span> pGraphics-&gt;GetMouseOver();</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;}</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;<span class="comment">// IGRAPHICS_TEXTFIELDCELL based on...</span></div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;<span class="comment">// https://red-sweater.com/blog/148/what-a-difference-a-cell-makes</span></div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;<span class="comment">// This source code is provided to you compliments of Red Sweater Software under the license as described below. NOTE: This is the MIT License.</span></div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;<span class="comment">// Copyright (c) 2006 Red Sweater Software</span></div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;<span class="comment">// Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the &quot;Software&quot;), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:</span></div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;<span class="comment">// The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.</span></div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;<span class="comment">// THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</span></div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;<span class="keyword">@implementation </span>IGRAPHICS_TEXTFIELDCELL</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;- (NSRect)drawingRectForBounds:(NSRect)theRect</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;{</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;  <span class="comment">// Get the parent&#39;s idea of where we should draw</span></div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;  NSRect newRect = [<span class="keyword">super</span> drawingRectForBounds:theRect];</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;  </div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;  <span class="comment">// When the text field is being</span></div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;  <span class="comment">// edited or selected, we have to turn off the magic because it screws up</span></div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;  <span class="comment">// the configuration of the field editor.  We sneak around this by</span></div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;  <span class="comment">// intercepting selectWithFrame and editWithFrame and sneaking a</span></div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;  <span class="comment">// reduced, centered rect in at the last minute.</span></div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;  <span class="keywordflow">if</span> (mIsEditingOrSelecting == NO)</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;  {</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;    <span class="comment">// Get our ideal size for current text</span></div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;    NSSize textSize = [<span class="keyword">self</span> cellSizeForBounds:theRect];</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;    </div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;    <span class="comment">// Center that in the proposed rect</span></div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;    <span class="keywordtype">float</span> heightDelta = newRect.size.height - textSize.height;</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;    <span class="keywordflow">if</span> (heightDelta &gt; 0)</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;    {</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;      newRect.size.height -= heightDelta;</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;      newRect.origin.y += (heightDelta / 2);</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;    }</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;  }</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;  </div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;  <span class="keywordflow">return</span> newRect;</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;}</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;- (void)selectWithFrame:(NSRect)aRect inView:(NSView *)controlView editor:(NSText *)textObj delegate:(<span class="keywordtype">id</span>)anObject start:(NSInteger)selStart length:(NSInteger)selLength</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;{</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;  aRect = [<span class="keyword">self</span> drawingRectForBounds:aRect];</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;  mIsEditingOrSelecting = YES;</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;  [<span class="keyword">super</span> selectWithFrame:aRect inView:controlView editor:textObj delegate:anObject start:selStart length:selLength];</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;  mIsEditingOrSelecting = NO;</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;}</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;- (void)editWithFrame:(NSRect)aRect inView:(NSView *)controlView editor:(NSText *)textObj delegate:(<span class="keywordtype">id</span>)anObject event:(NSEvent *)theEvent</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;{</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;  aRect = [<span class="keyword">self</span> drawingRectForBounds:aRect];</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;  mIsEditingOrSelecting = YES;</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;  [<span class="keyword">super</span> editWithFrame:aRect inView:controlView editor:textObj delegate:anObject event:theEvent];</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;  mIsEditingOrSelecting = NO;</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;}</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;<span class="keyword">@end</span></div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;<span class="keyword">@implementation </span>IGRAPHICS_FORMATTER</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;- (void) dealloc</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;{</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;  [filterCharacterSet release];</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;  [<span class="keyword">super</span> dealloc];</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;}</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;- (BOOL)isPartialStringValid:(NSString *)partialString newEditingString:(NSString **)newString errorDescription:(NSString **)error</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;{</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;  <span class="keywordflow">if</span> (filterCharacterSet != nil)</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;  {</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;    <span class="keywordtype">int</span> i = 0;</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;    <span class="keywordtype">int</span> len = (int) [partialString length];</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;    <span class="keywordflow">for</span> (i = 0; i &lt; len; i++)</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;    {</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;      <span class="keywordflow">if</span> (![filterCharacterSet characterIsMember:[partialString characterAtIndex:i]])</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;      {</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;        <span class="keywordflow">return</span> NO;</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;      }</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;    }</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;  }</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;  <span class="keywordflow">if</span> (maxLength)</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;  {</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;    <span class="keywordflow">if</span> ([partialString length] &gt; maxLength)</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;    {</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;      <span class="keywordflow">return</span> NO;</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;    }</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;  }</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;  <span class="keywordflow">if</span> (maxValue &amp;&amp; [partialString intValue] &gt; maxValue)</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;  {</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;    <span class="keywordflow">return</span> NO;</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;  }</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;  <span class="keywordflow">return</span> YES;</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;}</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;- (void) setAcceptableCharacterSet:(NSCharacterSet *) inCharacterSet</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;{</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;  [inCharacterSet retain];</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;  [filterCharacterSet release];</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;  filterCharacterSet = inCharacterSet;</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;}</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;- (void) setMaximumLength:(<span class="keywordtype">int</span>) inLength</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;{</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;  maxLength = inLength;</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;}</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;- (void) setMaximumValue:(<span class="keywordtype">int</span>) inValue</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;{</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;  maxValue = inValue;</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;}</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;- (NSString *)stringForObjectValue:(<span class="keywordtype">id</span>)anObject</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;{</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;  <span class="keywordflow">if</span> ([anObject isKindOfClass:[NSString <span class="keyword">class</span>]])</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;  {</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;    <span class="keywordflow">return</span> anObject;</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;  }</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;  <span class="keywordflow">return</span> nil;</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;}</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;- (BOOL)getObjectValue:(<span class="keywordtype">id</span> *)anObject forString:(NSString *)string errorDescription:(NSString **)error</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;{</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;  <span class="keywordflow">if</span> (anObject &amp;&amp; <span class="keywordtype">string</span>)</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;  {</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;    *anObject = [NSString stringWithString:string];</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;  }</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;  <span class="keywordflow">return</span> YES;</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;}</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;<span class="keyword">@end</span></div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;<span class="preprocessor">#pragma mark -</span></div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;<span class="keyword">@implementation </span>IGRAPHICS_VIEW</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;- (id) initWithIGraphics: (IGraphicsMac*) pGraphics</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;{</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;  TRACE;</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;  mGraphics = pGraphics;</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;  NSRect r;</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;  r.origin.x = r.origin.y = 0.0f;</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;  r.size.width = (float) pGraphics-&gt;WindowWidth();</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;  r.size.height = (float) pGraphics-&gt;WindowHeight();</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;  <span class="keyword">self</span> = [<span class="keyword">super</span> initWithFrame:r];</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;  </div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;<span class="preprocessor">#if defined IGRAPHICS_NANOVG</span></div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;<span class="preprocessor"></span><span class="preprocessor">  #if defined IGRAPHICS_METAL</span></div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;<span class="preprocessor"></span>    <span class="keywordflow">if</span> (!<span class="keyword">self</span>.wantsLayer) {</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;      <span class="keyword">self</span>.layer = [CAMetalLayer new];</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;      <span class="keyword">self</span>.layer.opaque = YES;</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;      <span class="keyword">self</span>.wantsLayer = YES;</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;    }</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;<span class="preprocessor">  #elif defined IGRAPHICS_GL</span></div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;<span class="preprocessor"></span>  <span class="comment">//TODO: IGRAPHICS_GL context setup</span></div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;<span class="preprocessor">  #endif</span></div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;  [<span class="keyword">self</span> registerForDraggedTypes:[NSArray arrayWithObjects: NSFilenamesPboardType, nil]];</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;  <span class="keywordtype">double</span> sec = 1.0 / (double) pGraphics-&gt;FPS();</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;  mTimer = [NSTimer timerWithTimeInterval:sec target:self selector:@selector(onTimer:) userInfo:nil repeats:YES];</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;  [[NSRunLoop currentRunLoop] addTimer: mTimer forMode: (NSString*) kCFRunLoopCommonModes];</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">self</span>;</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;}</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;- (void)dealloc</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;{</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;  [mMoveCursor release];</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;  [mTrackingArea release];</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;  [[NSNotificationCenter defaultCenter] removeObserver:self];</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;  [<span class="keyword">super</span> dealloc];</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;}</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;- (BOOL) isOpaque</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;{</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;  <span class="keywordflow">return</span> mGraphics ? YES : NO;</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;}</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;- (BOOL) isFlipped</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;{</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;  <span class="keywordflow">return</span> YES;</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;}</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;- (BOOL) acceptsFirstResponder</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;{</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;  <span class="keywordflow">return</span> YES;</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;}</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;- (BOOL) acceptsFirstMouse: (NSEvent*) pEvent</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;{</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;  <span class="keywordflow">return</span> YES;</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;}</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;- (void) viewDidMoveToWindow</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;{</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;  NSWindow* pWindow = [<span class="keyword">self</span> window];</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;  </div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;  <span class="keywordflow">if</span> (pWindow)</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;  {</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;    [pWindow makeFirstResponder: self];</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;    [pWindow setAcceptsMouseMovedEvents: YES];</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;    </div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;    <span class="keywordflow">if</span> (mGraphics)</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;      mGraphics-&gt;SetScreenScale([pWindow backingScaleFactor]);</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;    </div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;<span class="comment">//    [[NSNotificationCenter defaultCenter] addObserver:self</span></div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;<span class="comment">//                                             selector:@selector(windowResized:) name:NSWindowDidEndLiveResizeNotification</span></div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;<span class="comment">//                                               object:pWindow];</span></div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;<span class="comment">//    [[NSNotificationCenter defaultCenter] addObserver:self</span></div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;<span class="comment">//                                             selector:@selector(windowFullscreened:) name:NSWindowDidEnterFullScreenNotification</span></div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;<span class="comment">//                                               object:pWindow];</span></div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;<span class="comment">//    [[NSNotificationCenter defaultCenter] addObserver:self</span></div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;<span class="comment">//                                             selector:@selector(windowFullscreened:) name:NSWindowDidExitFullScreenNotification</span></div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;<span class="comment">//                                               object:pWindow];</span></div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;  }</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;}</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;- (void) viewDidChangeBackingProperties:(NSNotification *) notification</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;{</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;  NSWindow* pWindow = [<span class="keyword">self</span> window];</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;  </div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;  <span class="keywordflow">if</span> (!pWindow)</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;  </div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;  CGFloat newScale = [pWindow backingScaleFactor];</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;  </div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;  <span class="keywordflow">if</span> (newScale != mGraphics-&gt;GetScreenScale())</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;    mGraphics-&gt;SetScreenScale(newScale);</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;}</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;- (CGContextRef) getCGContextRef</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;{</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;  CGContextRef pCGC = (CGContextRef) [[NSGraphicsContext currentContext] graphicsPort];</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;  NSGraphicsContext* gc = [NSGraphicsContext graphicsContextWithGraphicsPort: pCGC flipped: YES];</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;  pCGC = (CGContextRef) [gc graphicsPort];</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;  <span class="keywordflow">return</span> pCGC;</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;}</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;<span class="comment">// not called for METAL</span></div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;- (void) drawRect: (NSRect) bounds</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;{</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;  <span class="keywordflow">if</span> (mGraphics)</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;  {</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;    <span class="keywordflow">if</span> (!mGraphics-&gt;GetPlatformContext())</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;      mGraphics-&gt;SetPlatformContext([<span class="keyword">self</span> getCGContextRef]);</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;      </div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;    <span class="keywordflow">if</span> (mGraphics-&gt;GetPlatformContext())</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;    {</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;      <span class="keyword">const</span> NSRect *rects;</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;      NSInteger numRects;</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;      [<span class="keyword">self</span> getRectsBeingDrawn:&amp;rects count:&amp;numRects];</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;      <a class="code" href="class_i_r_e_c_t_list.html">IRECTList</a> drawRects;</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; numRects; i++)</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;        drawRects.Add(ToIRECT(mGraphics, &amp;rects[i]));</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;      </div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;      mGraphics-&gt;Draw(drawRects);</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;    }</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;  }</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;}</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;- (void) onTimer: (NSTimer*) pTimer</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;{</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;  <a class="code" href="class_i_r_e_c_t_list.html">IRECTList</a> rects;</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;  <span class="keywordflow">if</span> (mGraphics-&gt;IsDirty(rects))</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;  {</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;    mGraphics-&gt;SetAllControlsClean();</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;    <span class="comment">// for METAL layer-backed view drawRect is not called</span></div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;<span class="preprocessor">#if !defined IGRAPHICS_NANOVG</span></div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;<span class="preprocessor"></span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; rects.Size(); i++)</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;      [self setNeedsDisplayInRect:ToNSRect(mGraphics, rects.Get(i))];</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;<span class="preprocessor"></span>    <span class="comment">// so just draw on each frame, if something is dirty</span></div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;    mGraphics-&gt;Draw(rects);</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;<span class="preprocessor"></span>  }</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;}</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;- (void) getMouseXY: (NSEvent*) pEvent x: (<span class="keywordtype">float</span>&amp;) pX y: (<span class="keywordtype">float</span>&amp;) pY</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;{</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;  <span class="keywordflow">if</span> (mGraphics)</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;  {</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;    NSPoint pt = [<span class="keyword">self</span> convertPoint:[pEvent locationInWindow] fromView:nil];</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;    pX = pt.x / mGraphics-&gt;GetDrawScale();</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;    pY = pt.y / mGraphics-&gt;GetDrawScale();</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;   </div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;    mGraphics-&gt;DoCursorLock(pX, pY, mPrevX, mPrevY);</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;    mGraphics-&gt;SetTabletInput(pEvent.subtype == NSTabletPointEventSubtype);</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;  }</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;}</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;- (<a class="code" href="group___i_graphics_structs.html#struct_i_mouse_info">IMouseInfo</a>) getMouseLeft: (NSEvent*) pEvent</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;{</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;  <a class="code" href="group___i_graphics_structs.html#struct_i_mouse_info">IMouseInfo</a> info;</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;  [<span class="keyword">self</span> getMouseXY:pEvent x:info.x y:info.y];</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;  <span class="keywordtype">int</span> mods = (int) [pEvent modifierFlags];</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;  info.ms = <a class="code" href="struct_i_mouse_mod.html">IMouseMod</a>(<span class="keyword">true</span>, (mods &amp; NSCommandKeyMask), (mods &amp; NSShiftKeyMask), (mods &amp; NSControlKeyMask), (mods &amp; NSAlternateKeyMask));</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;  <span class="keywordflow">return</span> info;</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;}</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;- (<a class="code" href="group___i_graphics_structs.html#struct_i_mouse_info">IMouseInfo</a>) getMouseRight: (NSEvent*) pEvent</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;{</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;  <a class="code" href="group___i_graphics_structs.html#struct_i_mouse_info">IMouseInfo</a> info;</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;  [<span class="keyword">self</span> getMouseXY:pEvent x:info.x y:info.y];</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;  <span class="keywordtype">int</span> mods = (int) [pEvent modifierFlags];</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;  info.ms = <a class="code" href="struct_i_mouse_mod.html">IMouseMod</a>(<span class="keyword">false</span>, <span class="keyword">true</span>, (mods &amp; NSShiftKeyMask), (mods &amp; NSControlKeyMask), (mods &amp; NSAlternateKeyMask));</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;  <span class="keywordflow">return</span> info;</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;}</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;- (void) updateTrackingAreas</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;{</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;  <span class="comment">// This is needed to get mouseEntered and mouseExited</span></div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;    </div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;  [<span class="keyword">super</span> updateTrackingAreas];</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;    </div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;  <span class="keywordflow">if</span> (mTrackingArea != nil) {</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;      [<span class="keyword">self</span> removeTrackingArea:mTrackingArea];</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;    [mTrackingArea release];</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;  }</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;    </div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;  <span class="keywordtype">int</span> opts = (NSTrackingMouseEnteredAndExited | NSTrackingActiveAlways);</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;  mTrackingArea = [ [NSTrackingArea alloc] initWithRect:[<span class="keyword">self</span> bounds] options:opts owner:self userInfo:nil];</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;  [<span class="keyword">self</span> addTrackingArea:mTrackingArea];</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;}</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;- (void) mouseEntered: (NSEvent *)event</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;{</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;  mGraphics-&gt;OnSetCursor();</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;}</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;- (void) mouseExited: (NSEvent *)event</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;{</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;  mGraphics-&gt;OnMouseOut();</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;}</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;- (void) mouseDown: (NSEvent*) pEvent</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;{</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;  <a class="code" href="group___i_graphics_structs.html#struct_i_mouse_info">IMouseInfo</a> info = [<span class="keyword">self</span> getMouseLeft:pEvent];</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;  <span class="keywordflow">if</span> (mGraphics)</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;  {</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;    <span class="keywordflow">if</span> ([pEvent clickCount] &gt; 1)</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;    {</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;      mGraphics-&gt;OnMouseDblClick(info.x, info.y, info.ms);</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;    }</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;    {</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;      mGraphics-&gt;OnMouseDown(info.x, info.y, info.ms);</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;    }</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;  }</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;}</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;- (void) mouseUp: (NSEvent*) pEvent</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;{</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;  <a class="code" href="group___i_graphics_structs.html#struct_i_mouse_info">IMouseInfo</a> info = [<span class="keyword">self</span> getMouseLeft:pEvent];</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;  <span class="keywordflow">if</span> (mGraphics)</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;    mGraphics-&gt;OnMouseUp(info.x, info.y, info.ms);</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;}</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;- (void) mouseDragged: (NSEvent*) pEvent</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;{</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;  <span class="comment">// Cache previous values before retrieving the new mouse position (which will update them)</span></div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;  <span class="keywordtype">float</span> prevX = mPrevX;</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;  <span class="keywordtype">float</span> prevY = mPrevY;</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;  <a class="code" href="group___i_graphics_structs.html#struct_i_mouse_info">IMouseInfo</a> info = [<span class="keyword">self</span> getMouseLeft:pEvent];</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;  <span class="keywordflow">if</span> (mGraphics &amp;&amp; !mTextFieldView)</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;    mGraphics-&gt;OnMouseDrag(info.x, info.y, info.x - prevX, info.y - prevY, info.ms);</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;}</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;- (void) rightMouseDown: (NSEvent*) pEvent</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;{</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;  <a class="code" href="group___i_graphics_structs.html#struct_i_mouse_info">IMouseInfo</a> info = [<span class="keyword">self</span> getMouseRight:pEvent];</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;  <span class="keywordflow">if</span> (mGraphics)</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;    mGraphics-&gt;OnMouseDown(info.x, info.y, info.ms);</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;}</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;- (void) rightMouseUp: (NSEvent*) pEvent</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;{</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;  <a class="code" href="group___i_graphics_structs.html#struct_i_mouse_info">IMouseInfo</a> info = [<span class="keyword">self</span> getMouseRight:pEvent];</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;  <span class="keywordflow">if</span> (mGraphics)</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;    mGraphics-&gt;OnMouseUp(info.x, info.y, info.ms);</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;}</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;- (void) rightMouseDragged: (NSEvent*) pEvent</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;{</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;  <span class="comment">// Cache previous values before retrieving the new mouse position (which will update them)</span></div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;  <span class="keywordtype">float</span> prevX = mPrevX;</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;  <span class="keywordtype">float</span> prevY = mPrevY;</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;  <a class="code" href="group___i_graphics_structs.html#struct_i_mouse_info">IMouseInfo</a> info = [<span class="keyword">self</span> getMouseRight:pEvent];</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;  <span class="keywordflow">if</span> (mGraphics &amp;&amp; !mTextFieldView)</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;    mGraphics-&gt;OnMouseDrag(info.x, info.y, info.x - prevX, info.y - prevY, info.ms);</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;}</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;- (void) mouseMoved: (NSEvent*) pEvent</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;{</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;  <a class="code" href="group___i_graphics_structs.html#struct_i_mouse_info">IMouseInfo</a> info = [<span class="keyword">self</span> getMouseLeft:pEvent];</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;  <span class="keywordflow">if</span> (mGraphics)</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;    mGraphics-&gt;OnMouseOver(info.x, info.y, info.ms);</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;}</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;- (void)keyDown: (NSEvent *)pEvent</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;{</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;  <span class="keywordtype">int</span> flag = 0;</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;  <span class="keywordtype">int</span> code = MacKeyEventToVK(pEvent, flag);</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;  NSString *s = [pEvent charactersIgnoringModifiers];</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;  unichar c = 0;</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;  </div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;  <span class="keywordflow">if</span> ([s length] == 1)</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;    c = [s characterAtIndex:0];</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;  </div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;  <span class="keywordflow">if</span>(!static_cast&lt;bool&gt;(flag &amp; kFVIRTKEY))</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;  {</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;    code = kVK_NONE;</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;  }</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;  </div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;  <a class="code" href="struct_i_key_press.html">IKeyPress</a> keyPress {<span class="keyword">static_cast&lt;</span><span class="keywordtype">char</span><span class="keyword">&gt;</span>(c), code, static_cast&lt;bool&gt;(flag &amp; kFSHIFT),</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;                                                  <span class="keyword">static_cast&lt;</span><span class="keywordtype">bool</span><span class="keyword">&gt;</span>(flag &amp; kFCONTROL),</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;                                                  static_cast&lt;bool&gt;(flag &amp; kFALT)};</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;  </div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;  <span class="keywordtype">bool</span> handle = mGraphics-&gt;OnKeyDown(mPrevX, mPrevY, keyPress);</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;  </div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;  <span class="keywordflow">if</span> (!handle)</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;  {</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;    [[<span class="keyword">self</span> nextResponder] keyDown:pEvent];</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;  }</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;}</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;- (void) scrollWheel: (NSEvent*) pEvent</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;{</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;  <span class="keywordflow">if</span> (mTextFieldView) [<span class="keyword">self</span> endUserInput ];</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;  <a class="code" href="group___i_graphics_structs.html#struct_i_mouse_info">IMouseInfo</a> info = [<span class="keyword">self</span> getMouseLeft:pEvent];</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;  <span class="keywordtype">float</span> d = [pEvent deltaY];</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;  <span class="keywordflow">if</span> (mGraphics)</div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;    mGraphics-&gt;OnMouseWheel(info.x, info.y, info.ms, d);</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;}</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> MakeCursorFromName(NSCursor*&amp; cursor, <span class="keyword">const</span> <span class="keywordtype">char</span> *name)</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;{</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;  <span class="comment">// get paths and intialise images etc.</span></div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">char</span>* basePath = <span class="stringliteral">&quot;/System/Library/Frameworks/ApplicationServices.framework/Versions/A/Frameworks/HIServices.framework/Versions/A/Resources/cursors/&quot;</span>;</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;  </div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;  NSString* imagePath = [NSString stringWithFormat:@&quot;%s%s/cursor.pdf&quot;, basePath, name];</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;  NSString* infoPath = [NSString stringWithFormat:@&quot;file:%s%s/info.plist&quot;, basePath, name];</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;  NSImage* fileImage = [[NSImage alloc] initByReferencingFile: imagePath];</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;  NSImage *cursorImage = [[NSImage alloc] initWithSize:[fileImage size]];</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;  NSDictionary* info = [NSDictionary dictionaryWithContentsOfURL:[NSURL URLWithString:infoPath]];</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;  </div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;  <span class="comment">// get info from dictionary</span></div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;  <span class="keywordtype">double</span> hotX = [info[@&quot;hotx-scaled&quot;] doubleValue];</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;  <span class="keywordtype">double</span> hotY = [info[@&quot;hoty-scaled&quot;] doubleValue];</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;  <span class="keywordtype">double</span> blur = [info[@&quot;blur&quot;] doubleValue];</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;  <span class="keywordtype">double</span> offsetX = [info[@&quot;shadowoffsetx&quot;] doubleValue];</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;  <span class="keywordtype">double</span> offsetY = [info[@&quot;shadowoffsety&quot;] doubleValue];</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;  <span class="keywordtype">double</span> red = [info[@&quot;shadowcolor&quot;][0] doubleValue];</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;  <span class="keywordtype">double</span> green = [info[@&quot;shadowcolor&quot;][1] doubleValue];</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;  <span class="keywordtype">double</span> blue = [info[@&quot;shadowcolor&quot;][2] doubleValue];</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;  <span class="keywordtype">double</span> alpha = [info[@&quot;shadowcolor&quot;][3] doubleValue];</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;  CGColorRef shadowColor = CGColorCreateGenericRGB(red, green, blue, alpha);</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;  </div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> scale = 1; scale &lt;= 4; scale++)</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;  {</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;    <span class="comment">// scale</span></div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;    NSAffineTransform* xform = [NSAffineTransform transform];</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;    [xform scaleBy:scale];</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;    <span class="keywordtype">id</span> hints = @{ NSImageHintCTM: xform };</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;    CGImageRef rasterCGImage = [fileImage CGImageForProposedRect:NULL context:nil hints:hints];</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;    </div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;    <span class="comment">// apply shadow</span></div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;    <span class="keywordtype">size_t</span> width = CGImageGetWidth(rasterCGImage);</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;    <span class="keywordtype">size_t</span> height = CGImageGetHeight(rasterCGImage);</div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;    CGSize offset = CGSize { offsetX * scale, offsetY * scale };</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;    CGContextRef shadowContext = CGBitmapContextCreate(NULL, width, height, CGImageGetBitsPerComponent(rasterCGImage), 0, CGImageGetColorSpace(rasterCGImage), CGImageGetBitmapInfo(rasterCGImage));</div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;    CGContextSetShadowWithColor(shadowContext, offset, blur * scale, shadowColor);</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;    CGContextDrawImage(shadowContext, CGRectMake(0, 0, width, height), rasterCGImage);</div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;    CGImageRef shadowCGImage = CGBitmapContextCreateImage(shadowContext);</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;    </div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;    <span class="comment">// add to cursor inmge</span></div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;    NSBitmapImageRep *rep = [[NSBitmapImageRep alloc] initWithCGImage:shadowCGImage];</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;    [rep setSize:[fileImage size]];</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;    [cursorImage addRepresentation:rep];</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;    </div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;    <span class="comment">// release</span></div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;    [rep release];</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;    CGContextRelease(shadowContext);</div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;    CGImageRelease(shadowCGImage);</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;  }</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;  </div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;  <span class="comment">// create cursor</span></div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;  cursor = [[NSCursor alloc] initWithImage:cursorImage hotSpot:NSMakePoint(hotX, hotY)];</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;  </div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;  <span class="comment">// release</span></div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;  [cursorImage release];</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;  [fileImage release];</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;  CGColorRelease(shadowColor);</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;}</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;- (void) setMouseCursor: (ECursor) cursorType</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;{</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;  NSCursor* pCursor = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;  </div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;  <span class="keywordtype">bool</span> helpCurrent = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;  <span class="keywordtype">bool</span> helpRequested = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;    </div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;  <span class="keywordflow">switch</span> (cursorType)</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;  {</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;    <span class="keywordflow">case</span> ECursor::ARROW: pCursor = [NSCursor arrowCursor]; <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;    <span class="keywordflow">case</span> ECursor::IBEAM: pCursor = [NSCursor IBeamCursor]; <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;    <span class="keywordflow">case</span> ECursor::WAIT:</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;      <span class="keywordflow">if</span> ([NSCursor respondsToSelector:<span class="keyword">@selector</span>(busyButClickableCursor)])</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;        pCursor = [NSCursor performSelector:@selector(busyButClickableCursor)];</div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;    <span class="keywordflow">case</span> ECursor::CROSS: pCursor = [NSCursor crosshairCursor]; <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;    <span class="keywordflow">case</span> ECursor::UPARROW:</div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;      <span class="keywordflow">if</span> ([NSCursor respondsToSelector:<span class="keyword">@selector</span>(_windowResizeNorthCursor)])</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;          pCursor = [NSCursor performSelector:@selector(_windowResizeNorthCursor)];</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;          pCursor = [NSCursor resizeUpCursor];</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;    <span class="keywordflow">case</span> ECursor::SIZENWSE:</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;      <span class="keywordflow">if</span> ([NSCursor respondsToSelector:<span class="keyword">@selector</span>(_windowResizeNorthWestSouthEastCursor)])</div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;        pCursor = [NSCursor performSelector:@selector(_windowResizeNorthWestSouthEastCursor)];</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;    <span class="keywordflow">case</span> ECursor::SIZENESW:</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;      <span class="keywordflow">if</span> ([NSCursor respondsToSelector:<span class="keyword">@selector</span>(_windowResizeNorthEastSouthWestCursor)])</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;        pCursor = [NSCursor performSelector:@selector(_windowResizeNorthEastSouthWestCursor)];</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;    <span class="keywordflow">case</span> ECursor::SIZEWE:</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;      <span class="keywordflow">if</span> ([NSCursor respondsToSelector:<span class="keyword">@selector</span>(_windowResizeEastWestCursor)])</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;        pCursor = [NSCursor performSelector:@selector(_windowResizeEastWestCursor)];</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;        pCursor = [NSCursor resizeLeftRightCursor];</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;    <span class="keywordflow">case</span> ECursor::SIZENS:</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;      <span class="keywordflow">if</span> ([NSCursor respondsToSelector:<span class="keyword">@selector</span>(_windowResizeNorthSouthCursor)])</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;        pCursor = [NSCursor performSelector:@selector(_windowResizeNorthSouthCursor)];</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;        pCursor = [NSCursor resizeUpDownCursor];</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;    <span class="keywordflow">case</span> ECursor::SIZEALL:</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;    {</div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;      <span class="keywordflow">if</span> (!mMoveCursor)</div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;        MakeCursorFromName(mMoveCursor, <span class="stringliteral">&quot;move&quot;</span>);</div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;      pCursor = mMoveCursor;</div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;    }</div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;    <span class="keywordflow">case</span> ECursor::INO: pCursor = [NSCursor operationNotAllowedCursor]; <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;    <span class="keywordflow">case</span> ECursor::HAND: pCursor = [NSCursor pointingHandCursor]; <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;    <span class="keywordflow">case</span> ECursor::APPSTARTING:</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;      <span class="keywordflow">if</span> ([NSCursor respondsToSelector:<span class="keyword">@selector</span>(busyButClickableCursor)])</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;        pCursor = [NSCursor performSelector:@selector(busyButClickableCursor)];</div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;       <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;    <span class="keywordflow">case</span> ECursor::HELP:</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;      <span class="keywordflow">if</span> ([NSCursor respondsToSelector:<span class="keyword">@selector</span>(_helpCursor)])</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;        pCursor = [NSCursor performSelector:@selector(_helpCursor)];</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;      helpRequested = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;    <span class="keywordflow">default</span>: pCursor = [NSCursor arrowCursor]; <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;  }</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;</div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;  <span class="keywordflow">if</span> ([NSCursor respondsToSelector:<span class="keyword">@selector</span>(helpCursorShown)])</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;    helpCurrent = [NSCursor performSelector:@selector(helpCursorShown)];</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;    </div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;  <span class="keywordflow">if</span> (helpCurrent &amp;&amp; !helpRequested)</div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;  {</div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;    <span class="comment">// N.B. - suppress warnings for this call only</span></div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;<span class="preprocessor">#pragma clang diagnostic push</span></div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#pragma clang diagnostic ignored &quot;-Wobjc-method-access&quot;</span></div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;<span class="preprocessor"></span>    [NSCursor _setHelpCursor : false];</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;<span class="preprocessor">#pragma clang diagnostic pop</span></div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;<span class="preprocessor"></span>  }</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;    </div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;  <span class="keywordflow">if</span> (!pCursor)</div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;    pCursor = [NSCursor arrowCursor];</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;</div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;  [pCursor set];</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;}</div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;- (void) killTimer</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;{</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;  [mTimer invalidate];</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;  mTimer = 0;</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;}</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;</div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;- (void) removeFromSuperview</div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;{</div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;  <span class="keywordflow">if</span> (mTextFieldView)</div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;    [<span class="keyword">self</span> endUserInput ];</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;  </div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;<span class="comment">//  if (mWebView) {</span></div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;<span class="comment">//    [mWebView removeFromSuperview ];</span></div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;<span class="comment">//    mWebView = nullptr;</span></div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;<span class="comment">//  }</span></div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;  </div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;  <span class="keywordflow">if</span> (mGraphics)</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;  {</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;    <a class="code" href="class_i_graphics.html">IGraphics</a>* pGraphics = mGraphics;</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;    mGraphics = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;    pGraphics-&gt;<a class="code" href="class_i_graphics.html#ab48d71443af011cc7fa6ef2c4578a22a">SetPlatformContext</a>(<span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;    </div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;    <span class="comment">//For some APIs (AUv2) this is where we know about the window being closed, close via delegate</span></div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;    pGraphics-&gt;<a class="code" href="class_i_graphics.html#a595e535d0b31c166b0a3742c83fe31b4">GetDelegate</a>()-&gt;<a class="code" href="class_i_g_editor_delegate.html#ad5b559c1586d0a2478a1a4e97b9cb34e">CloseWindow</a>();</div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;  }</div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;  [<span class="keyword">super</span> removeFromSuperview];</div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;}</div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;</div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;- (void) controlTextDidEndEditing: (NSNotification*) aNotification</div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;{</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;  <span class="keywordtype">char</span>* txt = (<span class="keywordtype">char</span>*)[[mTextFieldView stringValue] UTF8String];</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;</div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;  <span class="keywordflow">if</span> (mEdControl-&gt;GetParam())</div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;    mGraphics-&gt;SetControlValueFromStringAfterPrompt(*mEdControl, txt);</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;  mEdControl-&gt;OnTextEntryCompletion(txt);</div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;  mGraphics-&gt;SetAllControlsDirty();</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;  [<span class="keyword">self</span> endUserInput ];</div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;  [<span class="keyword">self</span> setNeedsDisplay: YES];</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;}</div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;</div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;- (<a class="code" href="class_i_popup_menu.html">IPopupMenu</a>*) createPopupMenu: (<a class="code" href="class_i_popup_menu.html">IPopupMenu</a>&amp;) menu : (NSRect) bounds;</div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;{</div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;  IGRAPHICS_MENU_RCVR* pDummyView = [[[IGRAPHICS_MENU_RCVR alloc] initWithFrame:bounds] autorelease];</div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;  NSMenu* pNSMenu = [[[IGRAPHICS_MENU alloc] initWithIPopupMenuAndReciever:&amp;menu : pDummyView] autorelease];</div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;  NSPoint wp = {bounds.origin.x, bounds.origin.y - 4};</div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;</div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;  [pNSMenu popUpMenuPositioningItem:nil atLocation:wp inView:self];</div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;  </div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;  NSMenuItem* pChosenItem = [pDummyView menuItem];</div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;  NSMenu* pChosenMenu = [pChosenItem menu];</div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;  <a class="code" href="class_i_popup_menu.html">IPopupMenu</a>* pIPopupMenu = [(IGRAPHICS_MENU*) pChosenMenu iPopupMenu];</div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;</div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;  <span class="keywordtype">long</span> chosenItemIdx = [pChosenMenu indexOfItem: pChosenItem];</div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;</div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;  <span class="keywordflow">if</span> (chosenItemIdx &gt; -1 &amp;&amp; pIPopupMenu)</div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;  {</div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;    pIPopupMenu-&gt;SetChosenItemIdx((<span class="keywordtype">int</span>) chosenItemIdx);</div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;    <span class="keywordflow">return</span> pIPopupMenu;</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;  }</div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;}</div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;</div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;- (void) createTextEntry: (<a class="code" href="class_i_control.html">IControl</a>&amp;) control : (const <a class="code" href="struct_i_text.html">IText</a>&amp;) text : (const <span class="keywordtype">char</span>*) str : (NSRect) areaRect;</div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;{</div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;  <span class="keywordflow">if</span> (mTextFieldView)</div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;</div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;  mTextFieldView = [[NSTextField alloc] initWithFrame: areaRect];</div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;  </div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;  <span class="keywordflow">if</span> (text.mVAlign == IText::kVAlignMiddle)</div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;  {</div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;    IGRAPHICS_TEXTFIELDCELL* pCell = [[IGRAPHICS_TEXTFIELDCELL alloc] initTextCell:@&quot;textfield&quot;];</div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;    [mTextFieldView setCell: pCell];</div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;    [mTextFieldView setEditable: TRUE];</div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;    [mTextFieldView setDrawsBackground: TRUE];</div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;  }</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;</div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;  <span class="comment">//TODO: address font types for platform text entries</span></div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;<span class="preprocessor">#ifdef IGRAPHICS_NANOVG</span></div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;<span class="preprocessor"></span>  NSString* font = [NSString stringWithUTF8String: &quot;Arial&quot;];</div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;<span class="preprocessor"></span>  NSString* font = [NSString stringWithUTF8String: text.mFont];</div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;  [mTextFieldView setFont: [NSFont fontWithName:font size: text.mSize * 0.75f]];</div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;  </div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;  <span class="keywordflow">switch</span> (text.mAlign)</div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;  {</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;    <span class="keywordflow">case</span> IText::kAlignNear:</div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;      [mTextFieldView setAlignment: NSLeftTextAlignment];</div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;    <span class="keywordflow">case</span> IText::kAlignCenter:</div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;      [mTextFieldView setAlignment: NSCenterTextAlignment];</div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;    <span class="keywordflow">case</span> IText::kAlignFar:</div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;      [mTextFieldView setAlignment: NSRightTextAlignment];</div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;    <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;  }</div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;</div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;  <span class="keyword">const</span> <a class="code" href="class_i_param.html">IParam</a>* pParam = control.GetParam();</div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;</div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;  <span class="comment">// set up formatter</span></div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;  <span class="keywordflow">if</span> (pParam)</div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;  {</div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;    NSMutableCharacterSet *characterSet = [[NSMutableCharacterSet alloc] init];</div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;</div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;    <span class="keywordflow">switch</span> ( pParam-&gt;Type() )</div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;    {</div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;      <span class="keywordflow">case</span> IParam::kTypeEnum:</div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;      <span class="keywordflow">case</span> IParam::kTypeInt:</div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;      <span class="keywordflow">case</span> IParam::kTypeBool:</div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;        [characterSet addCharactersInString:@&quot;0123456789-+&quot;];</div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;      <span class="keywordflow">case</span> IParam::kTypeDouble:</div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;        [characterSet addCharactersInString:@&quot;0123456789.-+&quot;];</div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;      <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;    }</div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;</div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;    [mTextFieldView setFormatter:[[[IGRAPHICS_FORMATTER alloc] init] autorelease]];</div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;    [[mTextFieldView formatter] setAcceptableCharacterSet:characterSet];</div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;    [[mTextFieldView formatter] setMaximumLength:control.GetTextEntryLength()];</div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;    [characterSet release];</div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;  }</div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;</div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;  [[mTextFieldView cell] setLineBreakMode: NSLineBreakByTruncatingTail];</div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;  [mTextFieldView setAllowsEditingTextAttributes:NO];</div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;  [mTextFieldView setTextColor:ToNSColor(text.mTextEntryFGColor)];</div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;  [mTextFieldView setBackgroundColor:ToNSColor(text.mTextEntryBGColor)];</div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;</div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;  [mTextFieldView setStringValue: ToNSString(str)];</div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;</div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;<span class="preprocessor">#ifndef COCOA_TEXTENTRY_BORDERED</span></div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;<span class="preprocessor"></span>  [mTextFieldView setBordered: NO];</div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;  [mTextFieldView setFocusRingType:NSFocusRingTypeNone];</div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;  [mTextFieldView setDelegate: self];</div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;</div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;  [<span class="keyword">self</span> addSubview: mTextFieldView];</div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;  NSWindow* pWindow = [<span class="keyword">self</span> window];</div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;  [pWindow makeKeyAndOrderFront:nil];</div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;  [pWindow makeFirstResponder: mTextFieldView];</div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;</div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;  mEdControl = &amp;control;</div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;}</div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;</div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;- (void) endUserInput</div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;{</div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;  [mTextFieldView setDelegate: nil];</div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;  [mTextFieldView removeFromSuperview];</div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;</div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;  NSWindow* pWindow = [<span class="keyword">self</span> window];</div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;  [pWindow makeFirstResponder: self];</div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;</div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;  mTextFieldView = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;  mEdControl = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;}</div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;</div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;<span class="comment">//- (void) createWebView: (NSRect) areaRect : (const char*) url</span></div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;<span class="comment">//{</span></div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;<span class="comment">//  mWebView = [[WKWebView alloc] initWithFrame: areaRect ];</span></div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;<span class="comment">//  [self addSubview: mWebView];</span></div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;<span class="comment">//  [mWebView loadRequest: [NSURLRequest requestWithURL: [NSURL URLWithString:[NSString stringWithUTF8String:url]]]];</span></div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;<span class="comment">//}</span></div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;<span class="comment">//-(void)userContentController:(WKUserContentController *)userContentController didReceiveScriptMessage:(WKScriptMessage *)message</span></div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;<span class="comment">//{</span></div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;<span class="comment">//  NSLog(@&quot;%@&quot;,message.body);</span></div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;<span class="comment">//}</span></div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;</div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;- (NSString*) view: (NSView*) pView stringForToolTip: (NSToolTipTag) tag point: (NSPoint) point userData: (<span class="keywordtype">void</span>*) pData</div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;{</div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;  <span class="keywordtype">int</span> c = mGraphics ? GetMouseOver(mGraphics) : -1;</div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;  <span class="keywordflow">if</span> (c &lt; 0) <span class="keywordflow">return</span> <span class="stringliteral">@&quot;&quot;</span>;</div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;</div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">char</span>* tooltip = mGraphics-&gt;GetControl(c)-&gt;GetTooltip();</div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;  <span class="keywordflow">return</span> CStringHasContents(tooltip) ? ToNSString((<span class="keyword">const</span> <span class="keywordtype">char</span>*) tooltip) : <span class="stringliteral">@&quot;&quot;</span>;</div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;}</div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;</div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;- (void) registerToolTip: (<a class="code" href="struct_i_r_e_c_t.html">IRECT</a>&amp;) bounds</div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;{</div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;  [<span class="keyword">self</span> addToolTipRect: ToNSRect(mGraphics, bounds) owner: self userData: nil];</div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;}</div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;</div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;- (NSDragOperation)draggingEntered: (<span class="keywordtype">id</span> &lt;NSDraggingInfo&gt;) sender</div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;{</div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;  NSPasteboard *pPasteBoard = [sender draggingPasteboard];</div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;</div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;  <span class="keywordflow">if</span> ([[pPasteBoard types] containsObject:NSFilenamesPboardType])</div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;    <span class="keywordflow">return</span> NSDragOperationGeneric;</div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;    <span class="keywordflow">return</span> NSDragOperationNone;</div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;}</div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;</div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;- (BOOL)performDragOperation: (<span class="keywordtype">id</span>&lt;NSDraggingInfo&gt;) sender</div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;{</div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;  NSPasteboard *pPasteBoard = [sender draggingPasteboard];</div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;</div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;  <span class="keywordflow">if</span> ([[pPasteBoard types] containsObject:NSFilenamesPboardType])</div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;  {</div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;    NSArray *pFiles = [pPasteBoard propertyListForType:NSFilenamesPboardType];</div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;    NSString *pFirstFile = [pFiles firstObject];</div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;    NSPoint point = [sender draggingLocation];</div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;    NSPoint relativePoint = [<span class="keyword">self</span> convertPoint: point fromView:nil];</div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;    <span class="comment">// TODO - fix or remove these values</span></div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;    <span class="keywordtype">float</span> x = relativePoint.x;<span class="comment">// - 2.f;</span></div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;    <span class="keywordtype">float</span> y = relativePoint.y;<span class="comment">// - 3.f;</span></div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;    mGraphics-&gt;OnDrop([pFirstFile UTF8String], x, y);</div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;  }</div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;</div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;  <span class="keywordflow">return</span> YES;</div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;}</div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;</div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;<span class="comment">//- (void)windowResized:(NSNotification *)notification;</span></div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;<span class="comment">//{</span></div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;<span class="comment">//  if(!mGraphics)</span></div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;<span class="comment">//    return;</span></div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;<span class="comment">//  NSSize windowSize = [[self window] frame].size;</span></div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;<span class="comment">//  NSRect viewFrameInWindowCoords = [self convertRect: [self bounds] toView: nil];</span></div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;<span class="comment">//  float width = windowSize.width - viewFrameInWindowCoords.origin.x;</span></div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;<span class="comment">//  float height = windowSize.height - viewFrameInWindowCoords.origin.y;</span></div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;<span class="comment">//  float scaleX = width / mGraphics-&gt;Width();</span></div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;<span class="comment">//  float scaleY = height / mGraphics-&gt;Height();</span></div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;<span class="comment">//  if(mGraphics-&gt;GetUIResizerMode() == EUIResizerMode::kUIResizerScale)</span></div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;<span class="comment">//    mGraphics-&gt;Resize(width, height, mGraphics-&gt;GetDrawScale());</span></div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;<span class="comment">//  else // EUIResizerMode::kUIResizerSize</span></div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;<span class="comment">//    mGraphics-&gt;Resize(mGraphics-&gt;Width(), mGraphics-&gt;Height(), Clip(std::min(scaleX, scaleY), 0.1f, 10.f));</span></div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;<span class="comment">//}</span></div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;<span class="comment">//- (void)windowFullscreened:(NSNotification *)notification;</span></div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;<span class="comment">//{</span></div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;<span class="comment">//  NSSize windowSize = [[self window] frame].size;</span></div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;<span class="comment">//  NSRect viewFrameInWindowCoords = [self convertRect: [self bounds] toView: nil];</span></div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;<span class="comment">//  float width = windowSize.width - viewFrameInWindowCoords.origin.x;</span></div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;<span class="comment">//  float height = windowSize.height - viewFrameInWindowCoords.origin.y;</span></div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;<span class="comment">//  float scaleX = width / mGraphics-&gt;Width();</span></div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;<span class="comment">//  float scaleY = height / mGraphics-&gt;Height();</span></div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;<span class="comment">//  if(mGraphics-&gt;GetUIResizerMode() == EUIResizerMode::kUIResizerScale)</span></div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;<span class="comment">//    mGraphics-&gt;Resize(width, height, mGraphics-&gt;GetDrawScale());</span></div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;<span class="comment">//  else // EUIResizerMode::kUIResizerSize</span></div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;<span class="comment">//    mGraphics-&gt;Resize(mGraphics-&gt;Width(), mGraphics-&gt;Height(), Clip(std::min(scaleX, scaleY), 0.1f, 10.f));</span></div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;<span class="comment">//}</span></div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;</div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;<span class="keyword">@end</span></div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;</div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;<span class="preprocessor">#endif //NO_IGRAPHICS</span></div>
<div class="ttc" id="class_i_r_e_c_t_list_html"><div class="ttname"><a href="class_i_r_e_c_t_list.html">IRECTList</a></div><div class="ttdoc">Used to manage a list of rectangular areas and optimize them for drawing to the screen. </div><div class="ttdef"><b>Definition:</b> <a href="_i_graphics_structs_8h_source.html#l01064">IGraphicsStructs.h:1064</a></div></div>
<div class="ttc" id="class_i_control_html"><div class="ttname"><a href="class_i_control.html">IControl</a></div><div class="ttdoc">The lowest level base class of an IGraphics control. </div><div class="ttdef"><b>Definition:</b> <a href="_i_control_8h_source.html#l00037">IControl.h:37</a></div></div>
<div class="ttc" id="struct_i_r_e_c_t_html"><div class="ttname"><a href="struct_i_r_e_c_t.html">IRECT</a></div><div class="ttdoc">Used to manage a rectangular area, independant of draw class/platform. </div><div class="ttdef"><b>Definition:</b> <a href="_i_graphics_structs_8h_source.html#l00527">IGraphicsStructs.h:527</a></div></div>
<div class="ttc" id="struct_i_mouse_mod_html"><div class="ttname"><a href="struct_i_mouse_mod.html">IMouseMod</a></div><div class="ttdoc">Used to manage mouse modifiers i.e. </div><div class="ttdef"><b>Definition:</b> <a href="_i_graphics_structs_8h_source.html#l01047">IGraphicsStructs.h:1047</a></div></div>
<div class="ttc" id="class_i_param_html"><div class="ttname"><a href="class_i_param.html">IParam</a></div><div class="ttdoc">IPlug&#39;s parameter class. </div><div class="ttdef"><b>Definition:</b> <a href="_i_plug_parameter_8h_source.html#l00027">IPlugParameter.h:27</a></div></div>
<div class="ttc" id="class_i_popup_menu_1_1_item_html"><div class="ttname"><a href="class_i_popup_menu_1_1_item.html">IPopupMenu::Item</a></div><div class="ttdoc">A class to specify an item of a pop up menu. </div><div class="ttdef"><b>Definition:</b> <a href="_i_graphics_popup_menu_8h_source.html#l00040">IGraphicsPopupMenu.h:40</a></div></div>
<div class="ttc" id="_i_plug_parameter_8h_html"><div class="ttname"><a href="_i_plug_parameter_8h.html">IPlugParameter.h</a></div><div class="ttdoc">IPlug&#39;s parameter class. </div></div>
<div class="ttc" id="_i_control_8h_html"><div class="ttname"><a href="_i_control_8h.html">IControl.h</a></div><div class="ttdoc">This file contains the base IControl implementation, along with some base classes for specific types ...</div></div>
<div class="ttc" id="class_i_graphics_html_ab48d71443af011cc7fa6ef2c4578a22a"><div class="ttname"><a href="class_i_graphics.html#ab48d71443af011cc7fa6ef2c4578a22a">IGraphics::SetPlatformContext</a></div><div class="ttdeci">virtual void SetPlatformContext(void *pContext)</div><div class="ttdoc">Set the platform draw context Used in order to set the platform level draw context - CGContextRef con...</div><div class="ttdef"><b>Definition:</b> <a href="_i_graphics_8h_source.html#l00629">IGraphics.h:629</a></div></div>
<div class="ttc" id="_i_plug_logger_8h_html"><div class="ttname"><a href="_i_plug_logger_8h.html">IPlugLogger.h</a></div><div class="ttdoc">IPlug logging a.k.a tracing functionality. </div></div>
<div class="ttc" id="class_i_g_editor_delegate_html_ad5b559c1586d0a2478a1a4e97b9cb34e"><div class="ttname"><a href="class_i_g_editor_delegate.html#ad5b559c1586d0a2478a1a4e97b9cb34e">IGEditorDelegate::CloseWindow</a></div><div class="ttdeci">void CloseWindow() finaloverride</div><div class="ttdoc">If you are not using IGraphics you can if you need to free resources etc when the window closes...</div><div class="ttdef"><b>Definition:</b> <a href="_i_graphics_editor_delegate_8cpp_source.html#l00059">IGraphicsEditorDelegate.cpp:59</a></div></div>
<div class="ttc" id="class_i_popup_menu_html"><div class="ttname"><a href="class_i_popup_menu.html">IPopupMenu</a></div><div class="ttdoc">A class for setting the contents of a pop up menu. </div><div class="ttdef"><b>Definition:</b> <a href="_i_graphics_popup_menu_8h_source.html#l00035">IGraphicsPopupMenu.h:35</a></div></div>
<div class="ttc" id="struct_i_text_html"><div class="ttname"><a href="struct_i_text.html">IText</a></div><div class="ttdoc">Used to manage font and text/text entry style for a piece of text on the UI, independant of draw clas...</div><div class="ttdef"><b>Definition:</b> <a href="_i_graphics_structs_8h_source.html#l00465">IGraphicsStructs.h:465</a></div></div>
<div class="ttc" id="group___i_graphics_structs_html_struct_i_mouse_info"><div class="ttname"><a href="group___i_graphics_structs.html#struct_i_mouse_info">IMouseInfo</a></div><div class="ttdoc">Used to group mouse coordinates with mouse modifier information. </div><div class="ttdef"><b>Definition:</b> <a href="_i_graphics_structs_8h_source.html#l01057">IGraphicsStructs.h:1057</a></div></div>
<div class="ttc" id="class_i_graphics_html"><div class="ttname"><a href="class_i_graphics.html">IGraphics</a></div><div class="ttdoc">The lowest level base class of an IGraphics context. </div><div class="ttdef"><b>Definition:</b> <a href="_i_graphics_8h_source.html#l00064">IGraphics.h:64</a></div></div>
<div class="ttc" id="class_i_graphics_html_a595e535d0b31c166b0a3742c83fe31b4"><div class="ttname"><a href="class_i_graphics.html#a595e535d0b31c166b0a3742c83fe31b4">IGraphics::GetDelegate</a></div><div class="ttdeci">IGEditorDelegate * GetDelegate()</div><div class="ttdoc">Gets a pointer to the delegate class that handles communication to and from this graphics context...</div><div class="ttdef"><b>Definition:</b> <a href="_i_graphics_8h_source.html#l00764">IGraphics.h:764</a></div></div>
<div class="ttc" id="struct_i_key_press_html"><div class="ttname"><a href="struct_i_key_press.html">IKeyPress</a></div><div class="ttdoc">Used for key press info, such as ASCII representation, virtual key (mapped to win32 codes) and modifi...</div><div class="ttdef"><b>Definition:</b> <a href="_i_graphics_structs_8h_source.html#l01033">IGraphicsStructs.h:1033</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon Jan 28 2019 21:26:11 for iPlug2 by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.6
</small></address>
</body>
</html>
